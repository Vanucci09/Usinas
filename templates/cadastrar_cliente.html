{% extends 'base.html' %}

{% block title %}Cadastrar Cliente{% endblock %}

{% block content %}
<div class="container mt-5 p-4 bg-white rounded shadow">
    <h2 class="mb-4 text-primary text-center">Cadastro de Clientes</h2>

    <form method="POST" action="{{ url_for('cadastrar_cliente') }}" onsubmit="return validarFormulario()">
        <div class="row g-3">
            <!-- Dados Pessoais -->
            <div class="col-md-6">
                <label for="nome" class="form-label">Nome</label>
                <input type="text" class="form-control" id="nome" name="nome" required>
            </div>
            <div class="col-md-6">
                <label for="cpf_cnpj" class="form-label">CPF ou CNPJ</label>
                <input type="text" class="form-control" id="cpf_cnpj" name="cpf_cnpj" required>
            </div>
            <div class="col-md-6">
                <label for="email" class="form-label">E-mail</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <div class="col-md-6">
                <label for="email_cc" class="form-label">E-mails em Cópia (CC)</label>
                <input type="text" class="form-control" id="email_cc" name="email_cc" placeholder="Ex: email1@exemplo.com, email2@exemplo.com">
            </div>
            <div class="col-md-6">
                <label for="telefone" class="form-label">Telefone</label>
                <input type="text" class="form-control" id="telefone" name="telefone" required>
            </div>

            <!-- Checkboxes -->
            <div class="form-check mt-2 ms-3">
                <input class="form-check-input" type="checkbox" name="mostrar_saldo" id="mostrar_saldo" checked>
                <label class="form-check-label" for="mostrar_saldo">
                    Mostrar Saldo Acumulado no Relatório
                </label>
            </div>

            <div class="form-check mt-2 ms-3">
                <input class="form-check-input" type="checkbox" id="consumo_instantaneo" name="consumo_instantaneo">
                <label class="form-check-label" for="consumo_instantaneo">
                    Cliente com Consumo Instantâneo
                </label>
            </div>

            <!-- ✅ Novo checkbox: Cliente ativo -->
            <div class="form-check mt-2 ms-3">
                <input class="form-check-input" type="checkbox" id="ativo" name="ativo" checked>
                <label class="form-check-label" for="ativo">
                    Cliente ativo
                </label>
            </div>

            <!-- Endereço e Unidade -->
            <div class="col-md-6">
                <label for="endereco" class="form-label">Endereço</label>
                <input type="text" class="form-control" id="endereco" name="endereco" required>
            </div>
            <div class="col-md-6">
                <label for="codigo_unidade" class="form-label">Código da Unidade</label>
                <input type="text" class="form-control" id="codigo_unidade" name="codigo_unidade" required>
            </div>
            <div class="col-md-12">
                <label for="usina_id" class="form-label">Usina</label>
                <select class="form-select" id="usina_id" name="usina_id" required>
                    <option value="" disabled selected>Selecione uma usina</option>
                    {% for usina in usinas %}
                        <option value="{{ usina.id }}">{{ usina.nome }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Novos campos -->
            <div class="col-md-6">
                <label for="login_concessionaria" class="form-label">Login da Concessionária</label>
                <input type="text" class="form-control" id="login_concessionaria" name="login_concessionaria">
            </div>
            <div class="col-md-6">
                <label for="senha_concessionaria" class="form-label">Senha da Concessionária</label>
                <input type="password" class="form-control" id="senha_concessionaria" name="senha_concessionaria">
            </div>

            <div class="form-check mt-2 ms-3">
                <input class="form-check-input" type="checkbox" id="relatorio_automatico" name="relatorio_automatico" onchange="toggleDiaRelatorio()">
                <label class="form-check-label" for="relatorio_automatico">
                    Gerar Relatório Automaticamente
                </label>
            </div>

            <div class="col-md-4" id="campo_dia_relatorio" style="display: none;">
                <label for="dia_relatorio" class="form-label">Dia do Relatório</label>
                <input type="number" class="form-control" id="dia_relatorio" name="dia_relatorio" min="1" max="31">
            </div>
        </div>

        <div class="mt-4 text-center">
            <button type="submit" class="btn btn-primary">Cadastrar Cliente</button>
        </div>
    </form>

    <!-- Botões de navegação -->
    <div class="text-center mt-4 d-flex justify-content-center gap-3 flex-wrap">
        <a href="{{ url_for('listar_clientes') }}" class="btn btn-primary">
            <i class="bi bi-list-ul"></i> Ver Clientes Cadastrados
        </a>
        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
            <i class="bi bi-house-door-fill"></i> Voltar para o Início
        </a>
    </div>
</div>

<script>
    function toggleDiaRelatorio() {
        const check = document.getElementById('relatorio_automatico');
        const campo = document.getElementById('campo_dia_relatorio');
        campo.style.display = check.checked ? 'block' : 'none';
    }

    function validarFormulario() {
        const check = document.getElementById('relatorio_automatico');
        const dia = document.getElementById('dia_relatorio');

        if (check.checked) {
            const valor = parseInt(dia.value);
            if (isNaN(valor) || valor < 1 || valor > 31) {
                alert("Por favor, informe um dia válido entre 1 e 31 para o relatório automático.");
                dia.focus();
                return false;
            }
        }

        return true;
    }

    window.addEventListener('DOMContentLoaded', toggleDiaRelatorio);
</script>

{% endblock %}
