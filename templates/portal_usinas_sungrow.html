<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Portal de Usinas - Sungrow</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { margin: 20px; font-family: Arial, sans-serif; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; }
    th { background: #f7f7f7; }
    tr:hover { background-color: #eef7ff; }
    .icone-verde { width: 12px; height: 12px; background: #27ae60; border-radius: 50%; display:inline-block; }
    .icone-cinza { width: 12px; height: 12px; background: #b5b5b5; border-radius: 50%; display:inline-block; }
    .btn-acao { padding: 6px 10px; border-radius: 4px; font-size: 13px; border:none; }
    .btn-coletar { background:#f39c12; color:#fff; }
    .btn-coletar:hover { background:#d68910; }
    .btn-vincular { background:#16a085; color:#fff; }
    .btn-vincular:hover { background:#13856e; }
  </style>
</head>
<body>

<h2>Portal de Usinas – Sungrow</h2>

{% if erro %}
  <div class="alert alert-danger">{{ erro }}</div>
{% endif %}

{% if usinas_info %}
<table>
  <thead>
    <tr>
      <th>Status</th>
      <th>Planta</th>
      <th>Capacidade</th>
      <th>Potência Atual</th>
      <th>Geração Hoje</th>
      <th>Geração Total</th>
      <th>Ações</th>
    </tr>
  </thead>

  <tbody>
  {% for u in usinas_info %}
    <tr>
      <td>
        {% if u.ps_status == 1 %}
          <span class="icone-verde"></span> Online
        {% else %}
          <span class="icone-cinza"></span> Offline
        {% endif %}
      </td>

      <td><strong>{{ u.nome }}</strong><br><small>ID {{ u.ps_id }}</small></td>
      <td>{{ u.capacidade or '-' }} kWp</td>
      <td>{{ "%.2f"|format(u.curr_kw) }} kW</td>
      <td>{{ "%.2f"|format(u.today_kwh) }} kWh</td>
      <td>{{ "%.3f"|format(u.total_mwh) }} MWh</td>

      <td>
  <!-- Botão de coletar ainda não implementado para Sungrow -->
  <span class="text-muted">Em breve: coleta</span>
</td>
  {% endfor %}
  </tbody>
</table>

{% else %}
  <p>Nenhuma usina encontrada.</p>
{% endif %}

</body>
</html>
